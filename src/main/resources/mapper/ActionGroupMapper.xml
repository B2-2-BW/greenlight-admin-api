<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.winten.greenlight.prototype.admin.db.repository.mapper.action.ActionGroupMapper">
    <sql id="selectFromActionGroup">
        SELECT
            id,
            owner_id,
            name,
            description,
            max_active_customers,
            enabled,
            created_by,
            created_at,
            updated_by,
            updated_at
        FROM action_group
    </sql>

    <select id="findAll" parameterType="String" resultType="ActionGroup">
        <include refid="selectFromActionGroup"/>
        <where>
            owner_id = #{ownerId}
        </where>
    </select>

    <select id="findOneById" parameterType="ActionGroup" resultType="ActionGroup">
        <include refid="selectFromActionGroup"/>
        <where>
            id = #{id}
            AND owner_id = #{ownerId}
        </where>
    </select>

    <select id="save" parameterType="ActionGroup" resultType="ActionGroup">
        INSERT INTO action_group
        (
            owner_id,
            name,
            description,
            max_active_customers,
            created_by,
            updated_by
        )
        VALUES
        (
            #{ownerId},
            #{name},
            #{description},
            #{maxActiveCustomers},
            #{ownerId},
            #{ownerId}
        )
        RETURNING *
    </select>

    <select id="updateById" parameterType="ActionGroup" resultType="ActionGroup">
        UPDATE action_group
        SET
            <if test="name != null and name != ''"> name = #{name}, </if>
            <if test="ownerId != null and ownerId != ''"> owner_id = #{ownerId}, </if>
            <if test="description != null and description != ''"> description = #{description}, </if>
            <if test="maxActiveCustomers != null and maxActiveCustomers != ''"> max_active_customers = #{maxActiveCustomers}, </if>
            <if test="enabled != null and enabled != ''"> enabled = #{enabled}, </if>
            updated_by = #{ownerId},
            updated_at = CURRENT_TIMESTAMP
        WHERE id = #{id}
        AND owner_id = #{ownerId}
        RETURNING *
    </select>

    <delete id="deleteById" parameterType="ActionGroup">
        DELETE FROM action_group
        WHERE id = #{id}
        AND owner_id = #{ownerId}
    </delete>
</mapper>